#!/usr/bin/with-contenv bash

unmount() {
    if findmnt "$1" | grep -q fuse; then
        fusermount -uz "$1"
    fi
}

checkmount() {
    if ! findmnt "$1" | grep -q fuse; then
        exit 1
    fi
}

waitmount() {
    while ! findmnt "$1" | grep -q fuse; do
        echo "*** waiting for mount $1. retrying in 2s ..."
        sleep 2
    done
}

pd_config="/config/config.json"
pd_token="/config/token.json"
pd_mountpoint="/enc"
pd_basic_opts="
-v 2
--config /config/
--uid=${PUID:-911}
--gid=${PGID:-911}
--umask=0100775
-o allow_other
"

rclone_config="/config/rclone.conf"
rclone_remote="dec:"
rclone_mountpoint="/dec"
rclone_basic_opts="
--config ${rclone_config}
--allow-other
--allow-non-empty
-v
"

mfs_mountpoint="/data"
mfs_basic_opts="-f -o uid=${PUID:-911},gid=${PGID:-911},umask=022,allow_other,nonempty"
mfs_branches="/local=RW:${rclone_mountpoint}${PLEXDRIVE_PATH:-}=NC"
